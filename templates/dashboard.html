<!DOCTYPE html>
<html>
<head>
    <title>Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<nav class="navbar navbar-dark bg-dark px-3">
    <span class="navbar-brand">Smart Expense Tracker</span>
    <a href="/logout" class="btn btn-outline-light">Logout</a>
</nav>

<div class="container mt-4">
    <h4>Welcome, {{ user.username }}</h4>

    <div class="row mt-4">
        <!-- Add Expense -->
        <div class="col-md-4">
            <div class="card shadow p-3">
                <h5>Add Expense</h5>
                <form method="POST" action="/add_expense">
                    <input class="form-control mb-2" name="amount" type="number" step="0.01" placeholder="Amount" required>
                    <select class="form-control mb-2" name="category" required>
                        <option>Food</option>
                        <option>Travel</option>
                        <option>Rent</option>
                        <option>Shopping</option>
                        <option>Other</option>
                    </select>
                    <input class="form-control mb-2" name="description" placeholder="Description">
                    <button class="btn btn-primary w-100">Add</button>
                </form>
            </div>
        </div>

        <!-- Chart -->
        <div class="col-md-8">
            <div class="card shadow p-3">
                <h5>Expense Distribution</h5>
                <canvas id="expenseChart"></canvas>
            </div>
        </div>
    </div>

    <div class="card shadow p-3 mt-4">
        <h5>Expense List</h5>
        <table class="table">
            <tr>
                <th>Amount</th>
                <th>Category</th>
                <th>Description</th>
            </tr>
            {% for exp in expenses %}
            <tr>
                <td>{{ exp.amount }}</td>
                <td>{{ exp.category }}</td>
                <td>{{ exp.description }}</td>
            </tr>
            {% endfor %}
        </table>

        <h5>Total: â‚¹ {{ total }}</h5>

        <form method="POST" action="/delete_all">
            <button class="btn btn-danger">Delete All</button>
        </form>
    </div>
</div>

<script>
const ctx = document.getElementById('expenseChart');
new Chart(ctx, {
    type: 'pie',
    data: {
        labels: {{ categories | safe }},
        datasets: [{
            data: {{ values | safe }},
            backgroundColor: ['#ff6384','#36a2eb','#ffce56','#8bc34a','#9c27b0']
        }]
    }
});
</script>

</body>
</html>
